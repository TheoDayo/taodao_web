<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tao Dao</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

<nav>
    <div class="logo">TaO DaO Kitchen</div>
</nav>

<section class="menu">
    <h1>Menu</h1>
    <div class="grid">
        <div class="column">
            <div class="nationality">
                <h3>Chinese</h3>
                <img class="flag" src="./img/flags/china.svg" alt="Chinese Flag">
            </div>
            <div class="cell">
                <img src="./img/dishes/kung-pao-chicken.jpeg">
                <div class="dish-name">Kung Pao Chicken</div>
                <div class="dietary-icon">ü•õ</div>
                <div class="dish-description">White rice with chicken and stir-fried veggies.</div>
            </div>
            <div class="cell">
                <img src="./img/dishes/kung-pao-chicken.jpeg">
                <div class="dish-name">Kung Pao Tofu</div>
                <div class="dietary-icon">ü•¶ü•õüçû</div>
                <div class="dish-description">White rice with tofu and stir-fried veggies.</div>
            </div>
        
        </div>
        <div class="column">
            <div class="nationality">
                <h3>Japanese</h3>
                <img class="flag" src="./img/flags/japan.png" alt="Japanese Flag">
            </div>
            <div class="cell">
                <img src="./img/dishes/oyakodon.jpg">
                <div class="dish-name">Oyakodon</div>
                <div class="dietary-icon">ü•õü•úüçû</div>
                <div class="dish-description">Sushi rice with umami-flavored eggs and onion</div>
            </div> 
            
        </div>
        <div class="column">
            <div class="nationality">
                <h3>Vietnamese</h3>
                <img class="flag" src="./img/flags/vietnam.png" alt="Vietnamese Flag">
            </div>
            <div class="cell">
                <img src="./img/dishes/summer-rolls.png">
                <div class="dish-name">Summer Rolls</div>
                <div class="dietary-icon">ü•¶ü•õ</div>
                <div class="dish-description">3 rolls of fresh veggie wraps with peanut sauce</div>
            </div>
        </div>
        <div class="column">
            <div class="nationality">
                <h3>Filipino</h3>
                <img class="flag" src="./img/flags/philippies.png" alt="Filipino Flag">
            </div>
            <div class="cell">
                <img src="./img/dishes/adobo.png">
                <div class="dish-name">Adobo</div>
                <div class="dietary-icon">ü•õü•ú</div>
                <div class="dish-description">White rice with chicken and potatoes marinated in soy sauce</div>
            </div>
        </div>
        <div class="column">
            <div class="nationality">
                <h3>South Korean</h3>
                <img class="flag" src="./img/flags/korean.png" alt="Korean Flag">
            </div>
            <div class="cell">
                <img src="./img/dishes/japchae.png">
                <div class="dish-name">Japchae</div>
                <div class="dietary-icon">ü•õü•ú</div>
                <div class="dish-description">Stir fried potato noodles with veggies, pork</div>
            </div>
            <div class="cell">
                <img src="./img/dishes/japchae.png">
                <div class="dish-name">Vegan Japchae</div>
                <div class="dietary-icon">ü•¶ü•õü•ú</div>
                <div class="dish-description">Stir fried potato noodles with veggies, tofu</div>
            </div>
        </div>
    </div>
</section>

<section class="icon-list">
    <div class="icon vegetarian">ü•¶ = Vegetarian</div>
    <div class="icon spicy">üå∂Ô∏è = Spicy</div>
    <span class="icon dairy-free">ü•õ = Dairy-free</div>
    <div class="icon gluten-free">üçû = Gluten-free</div>
    <div class="icon nut-free">ü•ú = Nut-free</div>
</section>

<!-- <section>
    <table>
        <tr>
            <th>Day</th>
            <th>Pickup</th>
            <th>Delivery</th>
        </tr>
        <tr>
            <td>Wednesday</td>
            <td>5:00pm - 6:00pm</td>
            <td>7:00pm - 8:00pm</td>
        </tr>
        <tr>
            <td>Thursday</td>
            <td>5:00pm - 6:00pm</td>
            <td>7:00pm - 8:00pm</td>
        </tr>
        <tr>
            <td>Friday</td>
            <td>11:00am - 1:00pm</td>
            <td>1:00pm - 2:00pm</td>
        </tr>
        <tr>
            <td>Saturday</td>
            <td>11:00am - 1:00pm</td>
            <td>1:00pm - 2:00pm</td>
        </tr>
    </table>
</section> -->

<section class="order-form">
    <h1>Order form</h1>

    <div>
        <!-- delivery and pickup times. table? -->
    </div>

    <p>Pickup Address: 33545 Rainbow Avenue, Abbotsford. Call or text the Chef when you arrive.</p>
    <p>Menu opens every Friday afternoon (12pm), and closes every Sunday midnight (12am)</p>
    

    <form method="post" action="https://sheetdb.io/api/v1/kji2pl9y6sbu9" id="sheetdb-form">
        <table>
            <tr>
                <th></th>
                <th>Dish name</th>
                <th>Delivery Type</th>
                <th>Time</th>
            </tr>

            <!-- Repeat this block for each dish -->
            <tr>
                <td>1.</td>

                <td>
                    <select class="dish-name" name="data[dishName]"></select>
                </td>

                <td>
                    <select id="deliveryType" class="deliveryType" name="data[deliveryType]"></select>
                </td>

                <td class="time">
                    <select  name="data[time]"></select>
                </td>
            </tr>
            <!-- Repeat this block for each dish -->

            <tr>
                <td>2.</td>

                <td>
                    <select class="dish-name" name="data[dishName]"></select>
                </td>

                <td>
                    <select id="deliveryType" class="deliveryType" name="data[deliveryType]"></select>
                </td>

                <td class="time">
                    <select name="data[time]"></select>
                </td>
            </tr>

            <tr>
                <td>3.</td>

                <td>
                    <select class="dish-name" name="data[dishName]"></select>
                </td>

                <td>
                    <select id="deliveryType" class="deliveryType" name="data[deliveryType]"></select>
                </td>

                <td class="time" >
                    <select name="data[time]"></select>
                </td>
            </tr>

            <tr>
                <td>4.</td>

                <td>
                    <select class="dish-name" name="data[dishName]"></select>
                </td>

                <td>
                    <select id="deliveryType" class="deliveryType" name="data[deliveryType]"></select>
                </td>

                <td class="time" >
                    <select name="data[time]"></select>
                </td>
            </tr>

            <tr>
                <td>5.</td>

                <td>
                    <select class="dish-name" name="data[dishName]"></select>
                </td>

                <td>
                    <select id="deliveryType" class="deliveryType" name="data[deliveryType]"></select>
                </td>

                <td class="time" >
                    <select name="data[time]"></select>
                </td>
            </tr>

            <tr>
                <td>6.</td>

                <td>
                    <select class="dish-name" name="data[dishName]"></select>
                </td>

                <td>
                    <select id="deliveryType" class="deliveryType" name="data[deliveryType]"></select>
                </td>

                <td class="time">
                    <select  name="data[time]"></select>
                </td>
            </tr>

            <tr>
                <td>7.</td>

                <td>
                    <select class="dish-name" name="data[dishName]"></select>
                </td>

                <td>
                    <select id="deliveryType" class="deliveryType" name="data[deliveryType]"></select>
                </td>

                <td class="time">
                    <select  name="data[time]"></select>
                </td>
            </tr>

            <tr>
                <td>8.</td>

                <td>
                    <select class="dish-name" name="data[dishName]"></select>
                </td>

                <td>
                    <select id="deliveryType" class="deliveryType" name="data[deliveryType]"></select>
                </td>

                <td class="time">
                    <select  name="data[time]"></select>
                </td>
            </tr>


        </table>

        <div>
            <label for="customerName">Your Name:</label>
            <input type="text" id="customerName" name="data[customerName]" required>
        </div>

        <div>
            <input type="submit" value="Submit" id="submit"></input>
        </div>
    </form>
</section>

<script>
    // Dish options without repetition
    const dishOptions = ["-","Kung Pao Chicken", "Kung Pao Tofu", "Adobo",  "Summer Rolls", "Japchae", "Vegan Japchae", "Oyakodon"];

    // Time options based on delivery type
    const pickupTimeOptions = ["Wednesday 6:00pm-7:00pm", "Thursday 6:00pm-7:00pm", "Friday 12:00pm - 1:00pm", "Saturday 12:00pm - 1:00pm"];
    const deliveryTimeOptions = ["Wednesday 7:00pm-8:00pm", "Thursday 7:00pm-8:00pm", "Friday 1:00pm - 2:00pm", "Saturday 1:00pm - 2:00pm"];
    const deliveryTypes = ["-","Delivery", "Pickup"];

    // Iterate over each select element with the class 'deliveryType'
    document.querySelectorAll('.deliveryType').forEach((deliveryTypeSelect, index) => {
        // Populate the options dynamically
        deliveryTypes.forEach(type => {
            const optionElement = document.createElement('option');
            optionElement.value = type.toLowerCase(); // Use lowercase for consistency
            optionElement.text = type;
            deliveryTypeSelect.add(optionElement);
        });
    });

    // Function to remove repetition and populate select options
    function populateSelectOptions(selectElement, options) {
        // Clear existing options
        selectElement.innerHTML = '';

        // Add unique options
        const uniqueOptions = [...new Set(options)];
        uniqueOptions.forEach(option => {
            const optionElement = document.createElement('option');
            optionElement.value = option;
            optionElement.text = option;
            selectElement.add(optionElement);
        });
    }

    // Function to update time options based on delivery type
    function updateTimeOptions(selectElement, deliveryType) {
        var timeOptions = "-";
        
        if (deliveryType === 'pickup') {
            timeOptions = pickupTimeOptions
        } else if ((deliveryType === 'delivery')) {
            timeOptions = deliveryTimeOptions;
        } 
        populateSelectOptions(selectElement, timeOptions);
    }

    // Add event listener to dynamically update time options when delivery type changes
    document.querySelectorAll('.deliveryType').forEach(select => {
        select.addEventListener('change', function() {
            const timeSelect = this.parentNode.nextElementSibling.querySelector('select[name^="data[time"]');
            updateTimeOptions(timeSelect, this.value);
        });
    });


    // Populate dishName and time options for each row
    document.querySelectorAll('tr').forEach((row, index) => {
        if (index > 0) { // Skip the header row
            const dishNameSelect = row.querySelector('select[name^="data[dishName"]');
            const deliveryTypeSelect = row.querySelector('select[name^="data[deliveryType"]');
            const timeSelect = row.querySelector('select[name^="data[time"]');

            // Populate dishName options
            populateSelectOptions(dishNameSelect, dishOptions);

            // Populate initial time options based on default delivery type (delivery)
            updateTimeOptions(timeSelect, deliveryTypeSelect.value);
        }
    });

    function validateSelections() {
    let atLeastOneDishSelected = false;

    // Iterate through each row (skip the header row)
    let valid = true;
    document.querySelectorAll('tr').forEach((row, index) => {
        if (index > 0) {
            const dishNameSelect = row.querySelector('select[name^="data[dishName"]');
            const deliveryTypeSelect = row.querySelector('select[name^="data[deliveryType"]');
            const timeSelect = row.querySelector('select[name^="data[time"]');

            // Check if a dish is selected
            if (dishNameSelect.value !== '-') {
                atLeastOneDishSelected = true;

                // Check if corresponding delivery type and time are selected
                if (deliveryTypeSelect.value === '-' || timeSelect.value === '-') {
                    alert('Both delivery type and time must be selected for each dish.');
                    valid = false;
                }
            }
        }
    });

    if (!atLeastOneDishSelected) {
        alert('Please select at least one dish.');
        valid = false;
    }

    return valid;
}

var form = document.getElementById('sheetdb-form');
form.addEventListener("submit", e => {
    e.preventDefault();

    // Validate selections
    if (!validateSelections()) {
        return;
    }
    
    // Array to store orders
    var orders = [];
 
        document.querySelectorAll('tr').forEach((row, index) => {
            if (index > 0) {
                const dishNameSelect = row.querySelector('select[name^="data[dishName"]');
                const deliveryTypeSelect = row.querySelector('select[name^="data[deliveryType"]');
                const timeSelect = row.querySelector('select[name^="data[time"]');
                const customerNameInput = document.getElementById('customerName');

              
                // Create an object with dishName, deliveryType, time, and customerName
                var orderData = {
                    'dishName': dishNameSelect.value,
                    'deliveryType': deliveryTypeSelect.value,
                    'time': timeSelect.value,
                    'customerName': customerNameInput.value
                };

                // Add the array to the orders array
                orders.push(orderData);
        }});

        // Convert the orders array to a JSON string
        var ordersJSON = JSON.stringify({ data: orders });

        // Log the JSON string to the console (you can modify this part based on your needs)
        console.log(ordersJSON);

        // Fetch data and submit the form
        fetch(form.action, {
            method: "POST",
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            body: ordersJSON


        }).then(
            response => response.json()
        ).then((html) => {
            // you can put any JS code here
            alert('Thank you! Your order is submitted successfully.')
        });
});



</script>


</body>
</html>
